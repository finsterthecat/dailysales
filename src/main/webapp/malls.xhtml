<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<f:view contentType="text/html">
    <h:head>
        <f:facet name="first">
            <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
            <title>Daily Sales</title>
        </f:facet>
    </h:head>

    <h:body>

        <p:layout fullPage="true">

            <p:layoutUnit position="north" size="110" resizable="true" closable="true" collapsible="true">
                <h1>Daily Sales</h1>
            </p:layoutUnit>

            <p:layoutUnit position="south" size="40" closable="true" collapsible="true">
                &copy; Brouwer Systems Inc
            </p:layoutUnit>

            <p:layoutUnit position="center">
                <f:view>
                    <h:form id="mallform">  
                        <p:growl id="growl" showDetail="true"/>
                             <p:breadCrumb>
                                <p:menuitem value="Malls" process="@this" action="#{mallBean.navHome}"
                                            update=":mallform:mallPanel :mallform:storePanel :mallform:salesPanel" />
                            </p:breadCrumb>
                       
                        <p:panel id="mallPanel" widgetVar="mallpanel"
                                 closable="true" toggleable="true" visible="#{mallBean.mallsVisible}">

                            <h1><h:outputText value="Malls"/></h1>
                            <p:dataTable id="mallTable"
                                         value="#{mallBean.findMalls()}"
                                         var="mall" rowKey="#{mall.id}"
                                         selection="#{mallBean.currentMall}" selectionMode="single"
                                         rows="5" paginator="true">
                                <p:ajax event="rowSelect" listener="#{mallBean.onMallSelect}"
                                            update=":mallform:mallPanel :mallform:storePanel :mallform:salesPanel"  />  
                                <p:ajax event="rowUnselect" listener="#{mallBean.onMallUnselect}" 
                                        update=":mallform:growl"/>  

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Name"/>
                                    </f:facet>
                                    <h:outputText value="#{mall.name}"/>
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Store Count"/>
                                    </f:facet>
                                    <h:outputText value="#{mall.storeCollection.size()}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        
                        <p:panel id="storePanel" widgetVar="outpanel"
                                 closable="true" toggleable="true" visible="#{mallBean.storesVisible}">

                           <h1><h:outputText value="Stores"/></h1>
                           <p:dataTable id="table"
                                         value="#{mallBean.findStores()}"
                                         var="store" rowKey="#{store.id}"
                                         selection="#{mallBean.currentStore}" selectionMode="single"
                                         rows="5" paginator="true">
                                <p:ajax event="rowSelect" listener="#{mallBean.onStoreSelect}"   
                                            update=":mallform:mallPanel :mallform:storePanel :mallform:salesPanel" />  
                                <p:ajax event="rowUnselect" 
                                        listener="#{mallBean.onStoreUnselect}" update=":mallform:growl"/>  

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Name"/>
                                    </f:facet>
                                    <h:outputText value="#{store.name}"/>
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Mall"/>
                                    </f:facet>
                                    <h:outputText value="#{store.mall.name}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        
                        <p:panel id="salesPanel" widgetVar="salespanel"
                                 closable="true" toggleable="true" visible="#{mallBean.salesVisible}">

                           <h1><h:outputText value="Sales"/></h1>
                           <p:dataTable id="salestable"
                                         value="#{mallBean.findMonthlySales()}"
                                         var="sale" rowKey="#{sale.id}"
                                         selection="#{mallBean.currentMonthlySales}" selectionMode="single"
                                         rows="5" paginator="true">
                                <p:ajax event="rowSelect" listener="#{mallBean.onMonthlySalesSelect}"   
                                            update=":mallform:mallPanel :mallform:storePanel" />  
                                <p:ajax event="rowUnselect" 
                                        listener="#{mallBean.onMonthlySalesUnselect}" update=":mallform:growl"/>  

                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Name"/>
                                    </f:facet>
                                    <h:outputText value="#{sale.store.name}"/>
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Cost"/>
                                    </f:facet>
                                    <h:outputText value="#{sale.costAmt}"/>
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Sales"/>
                                    </f:facet>
                                    <h:outputText value="#{sale.salesAmt}"/>
                                </p:column>
                                <p:column>
                                    <f:facet name="header">
                                        <h:outputText value="Actions"/>
                                    </f:facet>
                                    <p:commandButton value="Delete" id="deleteSale"
                                                     actionListener="#{mallBean.removeMonthlySales(sale)}" process="@this"
                                                     update=":mallform:salesPanel" />
                                </p:column>
                            </p:dataTable>
                            <p:commandLink value="New Sale" id="newSale" process="@this" oncomplete="salesDialog.show()" actionListener="#{mallBean.prepareNewMonthlySale}" update="salesDialog"/>
                        </p:panel>
                        
                        <p:dialog id="salesDialog" header="New Sales Entry" widgetVar="salesDialog" resizable="false"  
                                    showEffect="fade" hideEffect="explode">  
                            <h1><h:outputText value="Create"/></h1>
                            <p:messages id="msgs" />
                            <p:panelGrid columns="3">
                                <p:outputLabel value="SalesAmt:" for="salesAmt" />
                                <p:inputText id="salesAmt" value="#{mallBean.currentMonthlySales.salesAmt}"
                                             title="SalesAmt" required="true"
                                             requiredMessage="The SalesAmt field is required."/>
                                <p:message for="salesAmt" display="icon" />
                                <p:outputLabel value="CostAmt:" for="costAmt" />
                                <p:inputText id="costAmt" value="#{mallBean.currentMonthlySales.costAmt}"
                                             title="CostAmt" required="true"
                                             requiredMessage="The CostAmt field is required."/>
                                <p:message for="costAmt" display="icon"/>
                                <p:commandButton value="Create"
                                                 actionListener="#{mallBean.createMonthlySales}"
                                                 process="@parent"
                                                 update=":mallform:salesPanel " />
                            </p:panelGrid>
                        </p:dialog>  

                        
                    </h:form>
                </f:view>

            </p:layoutUnit>

        </p:layout>

    </h:body>

</f:view>

</html>

